<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Kerala Samajam Chennai</title>
<style>
  body{margin:0;font-family:Arial, sans-serif;background:#f8f9fa}
  .header{
    background:url('cover.jpg') no-repeat center/cover;
    height:200px;display:flex;align-items:center;justify-content:center;
    color:#fff;font-size:28px;font-weight:bold;
    text-shadow:2px 2px 6px rgba(0,0,0,0.5);
  }
  .container{display:flex;min-height:calc(100vh - 40px);}
  .sidebar{
    width:200px;background:#004d40;color:#fff;padding:20px 0;flex-shrink:0;
  }
  .sidebar a{
    display:block;padding:12px 20px;color:#fff;text-decoration:none;
    border-bottom:1px solid rgba(255,255,255,0.2);
  }
  .sidebar a:hover{background:#00695c;}
  .content{flex:1;padding:20px;}
  .footer{
    background:#222;color:#fff;text-align:center;padding:10px;
  }
  input,textarea,button,select{margin:5px 0;padding:6px;width:100%;}
  button{cursor:pointer;}
  .entry{border:1px solid #ccc;padding:8px;margin:8px 0;background:#fff;border-radius:4px;}
  .disabled{opacity:0.5;}
</style>
</head>
<body>

  <div class="header">
    KERALA SAMAJAM CHENNAI
  </div>

  <div class="container">
    <div class="sidebar">
      <a href="#" onclick="showSection('home')">Home</a>
      <a href="#" onclick="showSection('login')">Login</a>
      <a href="#" onclick="showSection('gallery')">Gallery</a>
    </div>
    <div class="content">
      
      <!-- Home -->
      <section id="home">
        <h2>Welcome to Kerala Samajam Chennai</h2>
        <p>Please register below:</p>
        <form id="regForm">
          <input placeholder="Name" id="name" required />
          <input placeholder="Phone" id="phone" required />
          <input placeholder="Email" id="email" required />
          <textarea placeholder="Address" id="address"></textarea>
          <button type="submit">Register</button>
        </form>
      </section>

      <!-- Login -->
      <section id="login" class="hidden">
        <h2>Admin Login</h2>
        <input type="password" id="adminPass" placeholder="Enter Password" />
        <button onclick="adminLogin()">Login</button>
      </section>

      <!-- Admin -->
      <section id="admin" class="hidden">
        <h2>Admin Dashboard</h2>
        <input type="text" id="searchBox" placeholder="Search by name or phone" oninput="renderAdminList()" />
        <div id="memberList"></div>
        <h3>Add Gallery Photo</h3>
        <input type="file" accept="image/*" id="photoUpload" onchange="addPhoto(event)" />
        <div id="gallery"></div>
        <button onclick="logoutAdmin()">Logout</button>
      </section>

      <!-- Gallery -->
      <section id="gallery" class="hidden">
        <h2>Gallery</h2>
        <div id="publicGallery"></div>
      </section>

    </div>
  </div>

  <div class="footer">
    Total Members: <span id="memberCount">0</span>
  </div>

<script>
const LS_MEMBERS="kerala_members";
const LS_GALLERY="kerala_gallery";
const ADMIN_PASSWORD="1234"; // change this

function el(id){return document.getElementById(id);}
function loadMembers(){return JSON.parse(localStorage.getItem(LS_MEMBERS)||"[]");}
function saveMembers(list){localStorage.setItem(LS_MEMBERS,JSON.stringify(list));}
function loadGallery(){return JSON.parse(localStorage.getItem(LS_GALLERY)||"[]");}
function saveGallery(list){localStorage.setItem(LS_GALLERY,JSON.stringify(list));}

function showSection(id){
  document.querySelectorAll(".content section").forEach(s=>s.classList.add("hidden"));
  el(id).classList.remove("hidden");
}

document.getElementById("regForm").onsubmit=function(e){
  e.preventDefault();
  let list=loadMembers();
  list.push({
    id:Date.now(),
    name:el("name").value,
    phone:el("phone").value,
    email:el("email").value,
    address:el("address").value,
    subscribed:true,
    active:true
  });
  saveMembers(list);
  alert("Registered successfully!");
  updateCount();
  e.target.reset();
}

function updateCount(){
  el("memberCount").innerText=loadMembers().length;
}
updateCount();

// Admin Login
function adminLogin(){
  if(el("adminPass").value===ADMIN_PASSWORD){
    showSection("admin");
    renderAdminList();
    renderGallery();
  }else alert("Wrong password");
}
function logoutAdmin(){
  showSection("home");
}

// Render Admin Members
function renderAdminList(){
  let q=el("searchBox").value.toLowerCase();
  let list=loadMembers().filter(m=>m.name.toLowerCase().includes(q)||m.phone.includes(q));
  if(list.length===0){el("memberList").innerHTML="<p>No members found</p>";return;}
  el("memberList").innerHTML=list.map(m=>`
    <div class="entry ${!m.active?'disabled':''}">
      <strong>${m.name}</strong> (${m.phone})<br>
      <small>${m.email}</small><br>
      <small>${m.address}</small><br>
      Subscribed: <input type="checkbox" ${m.subscribed?"checked":""} onclick="toggleSubscribe(${m.id})" />
      Active: <input type="checkbox" ${m.active?"checked":""} onclick="toggleActive(${m.id})" />
    </div>
  `).join("");
}

function toggleSubscribe(id){
  let list=loadMembers();
  let m=list.find(x=>x.id===id);
  m.subscribed=!m.subscribed;
  saveMembers(list);
  renderAdminList();
}
function toggleActive(id){
  let list=loadMembers();
  let m=list.find(x=>x.id===id);
  m.active=!m.active;
  saveMembers(list);
  renderAdminList();
}

// Gallery
function addPhoto(e){
  let file=e.target.files[0];
  if(!file) return;
  let reader=new FileReader();
  reader.onload=function(ev){
    let list=loadGallery();
    list.push(ev.target.result);
    saveGallery(list);
    renderGallery();
    renderPublicGallery();
  }
  reader.readAsDataURL(file);
}
function renderGallery(){
  let list=loadGallery();
  el("gallery").innerHTML=list.map(src=>`<img src="${src}" style="max-width:100px;margin:5px;border:1px solid #ccc"/>`).join("");
}
function renderPublicGallery(){
  let list=loadGallery();
  el("publicGallery").innerHTML=list.map(src=>`<img src="${src}" style="max-width:150px;margin:5px;border:1px solid #ccc"/>`).join("");
}
renderPublicGallery();
</script>
</body>
</html>
